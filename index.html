<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- --- CONFIGURACI√ìN PARA WHATSAPP / REDES SOCIALES --- -->
    <title>MUVN - Registro de Cuidados</title>
    <meta name="description" content="Herramienta exclusiva para el equipo de cuidadores.">

    <!-- Open Graph -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="MUVN - Equipo de Cuidados">
    <meta property="og:description" content="Cuidar con el coraz√≥n hace la diferencia. ‚ù§Ô∏è Gracias por tu dedicaci√≥n diaria.">
    <meta property="og:image" content="https://raw.githubusercontent.com/jesusvn1993mplvt3-ai/proyecto_cuidadores_MUVN/refs/heads/main/MUVN.jpg">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="MUVN - Equipo de Cuidados">
    <meta name="twitter:description" content="Cuidar con el coraz√≥n hace la diferencia. ‚ù§Ô∏è Gracias por tu dedicaci√≥n diaria.">
    <meta name="twitter:image" content="https://raw.githubusercontent.com/jesusvn1993mplvt3-ai/proyecto_cuidadores_MUVN/refs/heads/main/MUVN.jpg">
    
    <!-- --- LIBRER√çAS --- -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>

    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }
        /* Estilo para asegurar la firma de la fecha (DD/MM/YYYY) */
        .dob-input {
            letter-spacing: 2px;
            font-family: monospace;
        }
    </style>
</head>
<body class="bg-blue-50 text-gray-800 font-sans pb-24">

    <div id="root"></div>

    <script type="text/babel">

        // --- ICONOS ---
        const Icons = {
            Sun: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>,
            Moon: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></svg>,
            User: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>,
            CheckCircle: ({className}) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>,
            Clock: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
            Send: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>,
            Trash2: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg>,
            Activity: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>,
            AlertCircle: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>,
            ClipboardList: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="8" height="4" x="8" y="2" rx="1" ry="1"/><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><path d="M12 11h4"/><path d="M12 16h4"/><path d="M8 11h.01"/><path d="M8 16h.01"/></svg>,
            Heart: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></svg>,
            Lock: () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>,
            Unlock: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 8.355-3.791"/><path d="m15 7-1-1"/></svg>,
            Edit: () => <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>
        };

        const CAREGIVERS = [
            "Ana Mart√≠nez", "Carlos Vel√°zquez", "Beatriz Sol√≠s", "David L√≥pez", "Elena Ram√≠rez"
        ];

        // --- BASE DE DATOS DE PACIENTES (Incluyendo datos de seguridad y asignaci√≥n) ---
        // DD/MM/YYYY es el formato de la fecha de nacimiento (dob)
        const PATIENTS_DB = [
            {
                id: 'p1',
                name: "Don Roberto (Diabetes/Hipertensi√≥n)",
                details: "Insulinodependiente. Riesgo hipoglucemia.",
                caregiverId: "Ana Mart√≠nez",
                dob: "15/07/1945", 
                petName: "Max",
                tasks: {
                    dia: [
                        { id: 't1_d1', text: "Toma de Glucosa (Ayunas)", type: "vital" },
                        { id: 't1_d2', text: "Administrar Insulina (NPH 15 uds)", type: "med" },
                        { id: 't1_d3', text: "Desayuno (Dieta baja en az√∫car)", type: "food" },
                        { id: 't1_d4', text: "Toma de Presi√≥n Arterial", type: "vital" },
                        { id: 't1_d5', text: "Metformina 850mg", type: "med" }
                    ],
                    noche: [
                        { id: 't1_n1', text: "Cena ligera (7:00 PM)", type: "food" },
                        { id: 't1_n2', text: "Revisi√≥n de pa√±al (Seco)", type: "check" },
                        { id: 't1_n3', text: "Insulina Nocturna", type: "med" },
                        { id: 't1_n4', text: "Temp. habitaci√≥n (Fr√≠o)", type: "env" }
                    ]
                }
            },
            {
                id: 'p2',
                name: "Do√±a Mar√≠a (Alzheimer)",
                details: "Desorientaci√≥n espacial. No dejar sola.",
                caregiverId: "Ana Mart√≠nez",
                dob: "20/11/1939",
                petName: "Luna",
                tasks: {
                    dia: [
                        { id: 'p2_d1', text: "Memantina 10mg", type: "med" },
                        { id: 'p2_d2', text: "Aseo personal asistido", type: "hygiene" },
                        { id: 'p2_d3', text: "Ejercicios cognitivos", type: "activity" },
                        { id: 'p2_d4', text: "Hidrataci√≥n (Agua)", type: "food" }
                    ],
                    noche: [
                        { id: 'p2_n1', text: "Quetiapina (Si agitaci√≥n)", type: "med" },
                        { id: 'p2_n2', text: "Subir barandales cama", type: "safety" },
                        { id: 'p2_n3', text: "Revisi√≥n sue√±o (2 hrs)", type: "check" },
                        { id: 'p2_n4', text: "Cambio pa√±al (Crema)", type: "hygiene" }
                    ]
                }
            },
            {
                id: 'p3',
                name: "Sr. Pedro (Post-Op Cadera)",
                details: "Movilidad reducida. Riesgo de escaras.",
                caregiverId: "Carlos Vel√°zquez",
                dob: "03/04/1958",
                petName: "Bobby",
                tasks: {
                    dia: [
                        { id: 'p3_d1', text: "Curaci√≥n herida", type: "nursing" },
                        { id: 'p3_d2', text: "Tramadol (Dolor)", type: "med" },
                        { id: 'p3_d3', text: "Terapia f√≠sica suave", type: "activity" },
                        { id: 'p3_d4', text: "Cambio postura (3h)", type: "check" }
                    ],
                    noche: [
                        { id: 'p3_n1', text: "Analg√©sico Nocturno", type: "med" },
                        { id: 'p3_n2', text: "Postura: Lado Izquierdo", type: "check" },
                        { id: 'p3_n3', text: "Postura: Boca arriba", type: "check" },
                        { id: 'p3_n4', text: "Vaciar bolsa orina", type: "check" }
                    ]
                }
            },
            {
                id: 'p4',
                name: "Sra. Carmen (Parkinson)",
                details: "Temblores marcados. Riesgo atragantamiento.",
                caregiverId: "Carlos Vel√°zquez",
                dob: "01/01/1940",
                petName: "Mochi",
                tasks: {
                    dia: [
                        { id: 'p4_d1', text: "Levodopa (Estricto horario)", type: "med", note: "30 min antes de comida" },
                        { id: 'p4_d2', text: "Ayuda desayuno (Espesante)", type: "food" },
                        { id: 'p4_d3', text: "Caminata supervisada", type: "activity" }
                    ],
                    noche: [
                        { id: 'p4_n1', text: "Medicaci√≥n nocturna", type: "med" },
                        { id: 'p4_n2', text: "Facilitar ida al ba√±o", type: "check" },
                        { id: 'p4_n3', text: "Acomodar almohadas", type: "check" }
                    ]
                }
            },
            {
                id: 'p5',
                name: "Don Luis (EPOC / Ox√≠geno)",
                details: "Usa ox√≠geno 24h. Fatiga cr√≥nica.",
                caregiverId: "Beatriz Sol√≠s",
                dob: "10/05/1962",
                petName: "Kiko",
                tasks: {
                    dia: [
                        { id: 'p5_d1', text: "Nebulizaci√≥n matutina", type: "nursing" },
                        { id: 'p5_d2', text: "Revisar Tanque O2", type: "env", note: "Verificar litros por minuto" },
                        { id: 'p5_d3', text: "Oximetr√≠a (Saturaci√≥n)", type: "vital" },
                        { id: 'p5_d4', text: "Inhalador rescate", type: "med" }
                    ],
                    noche: [
                        { id: 'p5_n1', text: "Conectar CPAP/BiPAP", type: "nursing" },
                        { id: 'p5_n2', text: "Revisar Oximetr√≠a", type: "vital" },
                        { id: 'p5_n3', text: "Posici√≥n semi-sentado", type: "check" }
                    ]
                }
            },
            {
                id: 'p6',
                name: "Sra. Rosa (Artritis Reumatoide)",
                details: "Dolor articular severo en ma√±anas.",
                caregiverId: "Beatriz Sol√≠s",
                dob: "25/08/1950",
                petName: "Nala",
                tasks: {
                    dia: [
                        { id: 'p6_d1', text: "Compresas calientes manos", type: "nursing" },
                        { id: 'p6_d2', text: "Antiinflamatorio", type: "med" },
                        { id: 'p6_d3', text: "Ayuda vestimenta", type: "check" }
                    ],
                    noche: [
                        { id: 'p6_n1', text: "Medicaci√≥n dolor", type: "med" },
                        { id: 'p6_n2', text: "Cobija t√©rmica suave", type: "env" }
                    ]
                }
            },
            {
                id: 'p7',
                name: "Don Miguel (Recuperaci√≥n Ictus)",
                details: "Hemiparesia derecha. Dificultad habla.",
                caregiverId: "David L√≥pez",
                dob: "12/12/1970",
                petName: "Pelusa",
                tasks: {
                    dia: [
                        { id: 'p7_d1', text: "Anticoagulante", type: "med" },
                        { id: 'p7_d2', text: "Ejercicios lenguaje", type: "activity" },
                        { id: 'p7_d3', text: "Movilizaci√≥n brazo der.", type: "activity" }
                    ],
                    noche: [
                        { id: 'p7_n1', text: "Revisar presi√≥n arterial", type: "vital" },
                        { id: 'p7_n2', text: "Posici√≥n segura cama", type: "check" }
                    ]
                }
            },
            {
                id: 'p8',
                name: "Sra. Elena (Depresi√≥n/Ansiedad)",
                details: "Vigilar estado de √°nimo. Compa√±√≠a.",
                caregiverId: "David L√≥pez",
                dob: "29/02/1948",
                petName: "Coco",
                tasks: {
                    dia: [
                        { id: 'p8_d1', text: "Antidepresivo", type: "med" },
                        { id: 'p8_d2', text: "Conversaci√≥n/Paseo", type: "activity" },
                        { id: 'p8_d3', text: "Incentivar comida", type: "food" }
                    ],
                    noche: [
                        { id: 'p8_n1', text: "Ansiol√≠tico (Si precisa)", type: "med" },
                        { id: 'p8_n2', text: "Luz nocturna tenue", type: "env" }
                    ]
                }
            }
        ];

        function App() {
            // Estado de la Sesi√≥n
            const [caregiver, setCaregiver] = React.useState("");
            const [shift, setShift] = React.useState("");
            
            // Estado de Verificaci√≥n
            const [isVerified, setIsVerified] = React.useState(false);
            const [dobInput, setDobInput] = React.useState(""); // Fecha de Nacimiento (DD/MM/YYYY)
            const [petNameInput, setPetNameInput] = React.useState(""); // Nombre de Mascota
            const [verificationError, setVerificationError] = React.useState("");

            // Estado de Paciente y Registros
            const [patientId, setPatientId] = React.useState("");
            const [tempPatientId, setTempPatientId] = React.useState(""); 
            const [records, setRecords] = React.useState({});

            // Cargar estado desde localStorage al inicio
            React.useEffect(() => {
                const saved = localStorage.getItem('careApp_data_v3');
                if (saved) {
                    const parsed = JSON.parse(saved);
                    setCaregiver(parsed.caregiver || "");
                    setShift(parsed.shift || "");
                    setIsVerified(parsed.isVerified || false);
                    setPatientId(parsed.patientId || "");
                    if (parsed.patientId) setTempPatientId(parsed.patientId);
                    setRecords(parsed.records || {});
                }
            }, []);

            // Guardar estado en localStorage con cada cambio relevante
            React.useEffect(() => {
                const dataToSave = { caregiver, shift, isVerified, patientId, records };
                localStorage.setItem('careApp_data_v3', JSON.stringify(dataToSave));
            }, [caregiver, shift, isVerified, patientId, records]);

            // --- L√ìGICA DE VERIFICACI√ìN ---

            // Obtener lista de pacientes asignados al cuidador actual
            const assignedPatients = PATIENTS_DB.filter(p => p.caregiverId === caregiver);
            
            // Obtener lista √∫nica de mascotas para el men√∫ desplegable de verificaci√≥n
            const uniquePetNames = [...new Set(assignedPatients.map(p => p.petName))];

            const handleVerification = () => {
                setVerificationError("");

                if (!caregiver || !dobInput || !petNameInput) {
                    setVerificationError("Por favor, completa todos los campos de seguridad.");
                    return;
                }

                // Normalizar la fecha de nacimiento a DD/MM/YYYY (quitar espacios si los hubiera)
                const normalizedDob = dobInput.trim().replace(/\s/g, '');
                
                // Buscar si existe AL MENOS UN paciente asignado que coincida con la tripleta (Cuidador, DOB, Mascota)
                const matchFound = assignedPatients.some(p => 
                    p.dob === normalizedDob && 
                    p.petName === petNameInput
                );

                if (matchFound) {
                    setIsVerified(true);
                    setVerificationError("");
                } else {
                    setIsVerified(false);
                    setVerificationError("Error de verificaci√≥n. Los datos no coinciden con la asignaci√≥n.");
                }
            };
            
            // --- L√ìGICA DE TAREAS Y REPORTES ---

            const handleTaskCheck = (taskId) => {
                const now = new Date();
                const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', hour12: false }); // 24h format for simplicity
                const dateString = now.toLocaleDateString([], {day: 'numeric', month: 'short'});

                setRecords(prev => {
                    const current = prev[taskId] || {};
                    if (current.checked) {
                        return { ...prev, [taskId]: { ...current, checked: false, time: null } };
                    } else {
                        return { ...prev, [taskId]: { ...current, checked: true, time: `${dateString}, ${timeString}` } };
                    }
                });
            };

            const handleTaskNote = (taskId, text) => {
                setRecords(prev => ({
                    ...prev,
                    [taskId]: { ...(prev[taskId] || {}), note: text }
                }));
            };

            const resetAll = () => {
                if(window.confirm("¬øEst√°s seguro de borrar todos los datos y reiniciar?")) {
                    setCaregiver("");
                    setShift("");
                    setIsVerified(false);
                    setDobInput("");
                    setPetNameInput("");
                    setPatientId("");
                    setTempPatientId("");
                    setRecords({});
                    localStorage.removeItem('careApp_data_v3');
                }
            };
            
            // Reiniciar verificaci√≥n y paciente si cambia el cuidador
            React.useEffect(() => {
                setIsVerified(false);
                setPatientId("");
                setTempPatientId("");
                setDobInput("");
                setPetNameInput("");
            }, [caregiver]);

            const confirmPatientSelection = () => {
                if (!tempPatientId) return;
                setPatientId(tempPatientId);
            };

            const changePatient = () => {
                if (window.confirm("¬øDeseas cambiar de paciente? Los datos ingresados se mantendr√°n guardados pero ocultos.")) {
                    setPatientId("");
                }
            };
            
            const clearVerification = () => {
                setIsVerified(false);
                setPatientId("");
            };

            const generateWhatsAppLink = () => {
                if (!caregiver || !shift || !patientId) {
                    // Usar un modal simple en lugar de alert
                    console.error("Faltan datos para generar el reporte.");
                    return;
                }

                const patient = PATIENTS_DB.find(p => p.id === patientId);
                const taskList = patient.tasks[shift] || [];
                
                let message = `üìã *REPORTE MUVN*\n`;
                message += `üìÖ *Fecha:* ${new Date().toLocaleDateString()}\n`;
                message += `üë§ *Cuidador:* ${caregiver}\n`;
                message += `üåó *Turno:* ${shift === 'dia' ? '‚òÄÔ∏è Ma√±ana' : 'üåô Noche'}\n`;
                message += `üë¥ *Paciente:* ${patient.name}\n\n`;
                message += `‚úÖ *HECHO:*\n`;
                
                let completedCount = 0;
                taskList.forEach(task => {
                    const rec = records[task.id];
                    if (rec && rec.checked) {
                        completedCount++;
                        message += `üîπ ${task.text} (${rec.time})\n`;
                        if (rec.note) message += `   üìù Obs: ${rec.note}\n`;
                    }
                });

                if (completedCount === 0) message += `   (Sin registros)\n`;

                message += `\n‚ö†Ô∏è *PENDIENTE:*\n`;
                taskList.forEach(task => {
                    const rec = records[task.id];
                    if (!rec || !rec.checked) {
                        message += `üî∏ ${task.text}`;
                        if (rec && rec.note) message += ` - Obs: ${rec.note}`;
                        message += `\n`;
                    }
                });

                const encodedMsg = encodeURIComponent(message);
                window.open(`https://wa.me/?text=${encodedMsg}`, '_blank');
            };

            const currentPatient = PATIENTS_DB.find(p => p.id === patientId);
            const currentTasks = (currentPatient && shift) ? currentPatient.tasks[shift] : [];

            return (
                <div className="max-w-3xl mx-auto">
                    {/* HEADER */}
                    <header className="bg-sky-600 text-white p-4 shadow-md sticky top-0 z-10 rounded-b-xl">
                        <div className="flex justify-between items-center">
                            <div>
                                <h1 className="text-xl font-bold flex items-center gap-2">
                                    <Icons.Activity />
                                    MUVN
                                </h1>
                                <p className="text-xs text-sky-100 font-medium">Registro de Cuidados</p>
                            </div>
                            <button onClick={resetAll} className="bg-rose-500 hover:bg-rose-600 text-white p-2 rounded-lg text-xs flex items-center gap-1 shadow-sm transition-all">
                                <Icons.Trash2 /> Reiniciar
                            </button>
                        </div>
                    </header>

                    {/* MENSAJE MOTIVACIONAL */}
                    <div className="mx-4 mt-4 bg-white p-3 rounded-lg border border-sky-100 shadow-sm flex items-center gap-3">
                         <div className="p-2 bg-sky-100 rounded-full text-sky-600"><Icons.Heart /></div>
                         <div>
                            <p className="text-sm text-gray-700 italic">"Cuidar con el coraz√≥n hace la diferencia."</p>
                            <p className="text-xs text-gray-500 font-semibold">Gracias por tu dedicaci√≥n diaria.</p>
                         </div>
                    </div>

                    <main className="p-4 space-y-6">

                        {/* 1. SELECCI√ìN DE CUIDADOR */}
                        <section className="bg-white p-4 rounded-xl shadow-sm border border-gray-100">
                            <label className="block text-sm font-semibold text-gray-600 mb-2 flex items-center gap-2">
                                <Icons.User /> Selecciona Cuidador
                            </label>
                            <select 
                                value={caregiver} 
                                onChange={(e) => setCaregiver(e.target.value)}
                                className="w-full p-3 bg-gray-50 border border-gray-200 rounded-lg text-lg focus:ring-2 focus:ring-sky-500 outline-none"
                                disabled={isVerified}
                            >
                                <option value="">-- Elige tu nombre --</option>
                                {CAREGIVERS.map(c => <option key={c} value={c}>{c}</option>)}
                            </select>
                        </section>

                        {/* 2. VERIFICACI√ìN DE ACCESO */}
                        {caregiver && !isVerified && (
                            <section className="bg-red-50 p-4 rounded-xl shadow-md border border-red-200 animate-fade-in">
                                <h2 className="text-base font-bold text-red-700 mb-3 flex items-center gap-2">
                                    <Icons.Lock /> Verificaci√≥n de Acceso
                                </h2>
                                <p className="text-sm text-red-600 mb-4">
                                    Ingresa un dato de seguridad de *uno* de tus pacientes asignados para desbloquear la lista.
                                </p>

                                <div className="space-y-4">
                                    {/* Campo Fecha de Nacimiento */}
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">
                                            Fecha de Nacimiento del paciente (DD/MM/YYYY)
                                        </label>
                                        <input
                                            type="text"
                                            placeholder="Ej: 15/07/1945"
                                            value={dobInput}
                                            onChange={(e) => setDobInput(e.target.value)}
                                            className="w-full p-3 bg-white border border-gray-300 rounded-lg text-lg dob-input focus:ring-2 focus:ring-red-500 outline-none"
                                            maxLength={10}
                                        />
                                    </div>

                                    {/* Campo Nombre de Mascota */}
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">
                                            Nombre de Mascota (De un paciente asignado)
                                        </label>
                                        <select 
                                            value={petNameInput}
                                            onChange={(e) => setPetNameInput(e.target.value)}
                                            className="w-full p-3 bg-white border border-gray-300 rounded-lg text-lg focus:ring-2 focus:ring-red-500 outline-none"
                                        >
                                            <option value="">-- Elige una mascota --</option>
                                            {uniquePetNames.map(pName => (
                                                <option key={pName} value={pName}>{pName}</option>
                                            ))}
                                            {uniquePetNames.length === 0 && <option disabled>Sin mascotas asignadas</option>}
                                        </select>
                                    </div>
                                    
                                    {verificationError && (
                                        <div className="text-sm text-red-700 bg-red-100 p-2 rounded-lg font-medium">
                                            {verificationError}
                                        </div>
                                    )}

                                    <button 
                                        onClick={handleVerification}
                                        disabled={!dobInput || !petNameInput || uniquePetNames.length === 0}
                                        className={`w-full py-3 rounded-lg font-bold flex items-center justify-center gap-2 transition-all ${dobInput && petNameInput ? 'bg-red-600 text-white shadow-md hover:bg-red-700' : 'bg-gray-200 text-gray-400 cursor-not-allowed'}`}
                                    >
                                        <Icons.Unlock className="w-5 h-5" />
                                        Desbloquear Pacientes
                                    </button>
                                </div>
                            </section>
                        )}


                        {/* 3. SELECCI√ìN DE PACIENTE (FILTRADO Y CONFIRMACI√ìN) */}
                        {caregiver && isVerified && (
                            <section className="bg-white p-4 rounded-xl shadow-sm border border-gray-100 animate-fade-in">
                                <label className="block text-sm font-semibold text-gray-600 mb-2 flex items-center gap-2">
                                        <Icons.ClipboardList />
                                        Selecciona Paciente Asignado ({assignedPatients.length})
                                </label>

                                {!patientId ? (
                                    // ESTADO: SIN CONFIRMAR (Men√∫ Desplegable FILTRADO)
                                    <div className="space-y-3">
                                        <select 
                                            value={tempPatientId}
                                            onChange={(e) => setTempPatientId(e.target.value)}
                                            className="w-full p-3 bg-gray-50 border border-gray-300 rounded-lg text-gray-800 text-lg focus:ring-2 focus:ring-sky-500 outline-none"
                                        >
                                            <option value="">-- Elige el paciente a registrar --</option>
                                            {assignedPatients.map(p => (
                                                <option key={p.id} value={p.id}>{p.name}</option>
                                            ))}
                                        </select>
                                        
                                        <button 
                                            onClick={confirmPatientSelection}
                                            disabled={!tempPatientId}
                                            className={`w-full py-3 rounded-lg font-bold flex items-center justify-center gap-2 transition-all ${tempPatientId ? 'bg-sky-600 text-white shadow-md hover:bg-sky-700' : 'bg-gray-200 text-gray-400 cursor-not-allowed'}`}
                                        >
                                            <Icons.CheckCircle className="w-5 h-5" />
                                            Confirmar Paciente
                                        </button>
                                        <button 
                                            onClick={clearVerification}
                                            className="w-full text-sm text-red-500 hover:text-red-700 underline pt-2"
                                        >
                                            Cambiar datos de verificaci√≥n
                                        </button>
                                    </div>
                                ) : (
                                    // ESTADO: CONFIRMADO (Tarjeta Bloqueada)
                                    <div className="bg-sky-50 border border-sky-200 rounded-lg p-4 flex justify-between items-center">
                                        <div>
                                            <div className="flex items-center gap-2 text-sky-800 font-bold text-lg">
                                                {PATIENTS_DB.find(p => p.id === patientId).name}
                                                <Icons.Lock />
                                            </div>
                                            <p className="text-sm text-sky-600 mt-1">
                                                {PATIENTS_DB.find(p => p.id === patientId).details}
                                            </p>
                                        </div>
                                        <button 
                                            onClick={changePatient}
                                            className="text-xs text-gray-500 hover:text-sky-600 underline flex items-center gap-1 ml-4"
                                        >
                                            <Icons.Edit /> Cambiar
                                        </button>
                                    </div>
                                )}
                            </section>
                        )}


                        {/* 4. SELECCI√ìN DE TURNO (Solo si est√° verificado) */}
                        {isVerified && (
                            <section className="grid grid-cols-2 gap-4 animate-fade-in">
                                <button 
                                    onClick={() => setShift('dia')}
                                    className={`p-4 rounded-xl border-2 flex flex-col items-center justify-center gap-2 transition-all ${shift === 'dia' ? 'border-amber-400 bg-amber-50 text-amber-700' : 'border-gray-200 bg-white text-gray-400'}`}
                                >
                                    <div className={shift === 'dia' ? 'text-amber-500' : ''}><Icons.Sun /></div>
                                    <span className="font-bold">Turno D√≠a</span>
                                </button>
                                <button 
                                    onClick={() => setShift('noche')}
                                    className={`p-4 rounded-xl border-2 flex flex-col items-center justify-center gap-2 transition-all ${shift === 'noche' ? 'border-indigo-500 bg-indigo-50 text-indigo-700' : 'border-gray-200 bg-white text-gray-400'}`}
                                >
                                    <div className={shift === 'noche' ? 'text-indigo-600' : ''}><Icons.Moon /></div>
                                    <span className="font-bold">Turno Noche</span>
                                </button>
                            </section>
                        )}


                        {/* 5. LISTA DE TAREAS */}
                        {caregiver && isVerified && shift && patientId && (
                            <section className="space-y-4 animate-fade-in">
                                <div className="flex items-center gap-2 mb-2">
                                    <h2 className="text-lg font-bold text-gray-800">
                                        Obligaciones ({shift === 'dia' ? 'D√≠a' : 'Noche'})
                                    </h2>
                                    <span className="bg-sky-100 text-sky-800 text-xs px-2 py-1 rounded-full font-medium">
                                        {currentTasks.length} Tareas
                                    </span>
                                </div>

                                {currentTasks.map((task) => {
                                    const record = records[task.id] || {};
                                    const isChecked = record.checked || false;

                                    let borderClass = "border-gray-200";
                                    if (task.type === 'med') borderClass = "border-l-4 border-l-rose-400";
                                    if (task.type === 'vital') borderClass = "border-l-4 border-l-emerald-400";
                                    if (task.type === 'check') borderClass = "border-l-4 border-l-purple-400";
                                    if (task.type === 'env') borderClass = "border-l-4 border-l-sky-400";

                                    return (
                                        <div key={task.id} className={`bg-white rounded-lg shadow-sm border p-4 ${borderClass} transition-all ${isChecked ? 'bg-gray-50' : ''}`}>
                                            <div className="flex items-start gap-3">
                                                <button
                                                    onClick={() => handleTaskCheck(task.id)}
                                                    className={`mt-1 flex-shrink-0 w-8 h-8 rounded-full border-2 flex items-center justify-center transition-all ${isChecked ? 'bg-emerald-500 border-emerald-500 text-white' : 'border-gray-300 text-transparent hover:border-emerald-400'}`}
                                                >
                                                    <Icons.CheckCircle className={isChecked ? "opacity-100" : "opacity-0"} />
                                                </button>
                                                
                                                <div className="flex-1">
                                                    <h3 className={`font-medium text-gray-800 text-lg leading-tight ${isChecked ? 'line-through text-gray-400' : ''}`}>
                                                        {task.text}
                                                    </h3>
                                                    
                                                    {task.note && (
                                                        <div className="mt-1 flex items-start gap-1 text-sm text-amber-600 bg-amber-50 p-2 rounded">
                                                            <div className="mt-0.5"><Icons.AlertCircle /></div>
                                                            <span>{task.note}</span>
                                                        </div>
                                                    )}

                                                    {isChecked && record.time && (
                                                        <div className="mt-2 inline-flex items-center gap-1 text-xs font-bold text-emerald-700 bg-emerald-100 px-2 py-1 rounded">
                                                            <Icons.Clock />
                                                            Completado: {record.time}
                                                        </div>
                                                    )}
                                                </div>
                                            </div>

                                            <div className="mt-3 pl-11">
                                                <textarea
                                                    placeholder="Observaciones..."
                                                    value={record.note || ""}
                                                    onChange={(e) => handleTaskNote(task.id, e.target.value)}
                                                    className="w-full text-sm p-2 border border-gray-200 rounded-md focus:ring-1 focus:ring-sky-400 outline-none resize-none bg-gray-50 focus:bg-white"
                                                    rows={2}
                                                />
                                            </div>
                                        </div>
                                    );
                                })}
                            </section>
                        )}

                    </main>

                    {/* FOOTER */}
                    {caregiver && isVerified && shift && patientId && (
                        <div className="fixed bottom-0 left-0 w-full bg-white border-t border-gray-200 p-4 shadow-lg z-20">
                            <div className="max-w-3xl mx-auto">
                                <button
                                    onClick={generateWhatsAppLink}
                                    className="w-full bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-3 px-6 rounded-xl shadow-md flex items-center justify-center gap-2 text-lg transition-transform active:scale-95"
                                >
                                    <Icons.Send />
                                    Enviar Reporte
                                </button>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

